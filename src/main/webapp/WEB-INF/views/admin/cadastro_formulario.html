<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Cadastros Gerais</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Acordeão simples (JS nativo) -->
    <script>
        function toggle(id) {
            const section = document.getElementById(id);
            section.classList.toggle("hidden");
        }
    </script>
</head>

<body class="bg-gray-100 min-h-screen">

<header class="bg-slate-800 text-white py-6 text-center text-2xl font-semibold shadow">
    Cadastros Gerais
</header>

<div class="max-w-5xl mx-auto px-6 py-10">

    <!-- ACORDEÃO 1 - PROCESSOS AVALIATIVOS -->
    <div class="mb-4 bg-white shadow rounded-xl">
        <button onclick="toggle('processos')"
                class="w-full text-left p-4 text-lg font-semibold flex justify-between items-center">
            Processos Avaliativos
            <span>▼</span>
        </button>

        <div id="processos" class="hidden border-t p-5">

            <!-- Formulário CRUD -->
            <h3 class="text-lg font-semibold mb-3">Criar / Editar Processo Avaliativo</h3>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">

                <input type="date" id="datainicio" class="border rounded p-2" placeholder="Data início">
                <input type="date" id="datafim" class="border rounded p-2" placeholder="Data fim">

                <input type="text" id="descricao" class="border rounded p-2" placeholder="Descrição">
            </div>

            <div class="mt-4 flex gap-3">
                <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Salvar</button>
                <button class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Atualizar</button>
                <button class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Excluir</button>
            </div>

            <h4 class="mt-6 text-md font-semibold">Lista de Processos:</h4>
            <table class="w-full mt-2 border">
                <thead class="bg-gray-200">
                <tr>
                    <th class="p-2 border">ID</th>
                    <th class="p-2 border">Início</th>
                    <th class="p-2 border">Fim</th>
                    <th class="p-2 border">Descrição</th>
                </tr>
                </thead>
                <tbody id="tabelaProcessos">
                <!-- preenchido dinamicamente -->
                </tbody>
            </table>

        </div>
    </div>

    <!-- ACORDEÃO 2 - FORMULÁRIOS -->
    <div class="mb-4 bg-white shadow rounded-xl">
        <button onclick="toggle('formularios')"
                class="w-full text-left p-4 text-lg font-semibold flex justify-between items-center">
            Formulários
            <span>▼</span>
        </button>

        <div id="formularios" class="hidden border-t p-5">

            <h3 class="text-lg font-semibold mb-3">Criar / Editar Formulário</h3>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">

                <select id="processoSelect" class="border rounded p-2">
                    <option value="">Selecione um processo avaliativo</option>
                </select>

                <input type="text" id="titulo" class="border rounded p-2" placeholder="Título">

                <select id="anonimo" class="border rounded p-2">
                    <option value="true">Anônimo</option>
                    <option value="false">Identificado</option>
                </select>
            </div>

            <div class="mt-4 flex gap-3">
                <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Salvar</button>
                <button class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Atualizar</button>
                <button class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Excluir</button>
            </div>

            <h4 class="mt-6 text-md font-semibold">Lista de Formulários:</h4>
            <table class="w-full mt-2 border">
                <thead class="bg-gray-200">
                <tr>
                    <th class="p-2 border">ID</th>
                    <th class="p-2 border">Título</th>
                    <th class="p-2 border">Anônimo</th>
                    <th class="p-2 border">Processo</th>
                </tr>
                </thead>
                <tbody id="tabelaFormularios">
                </tbody>
            </table>

        </div>
    </div>

    <!-- ACORDEÃO 3 - QUESTÕES -->
    <div class="mb-4 bg-white shadow rounded-xl">
        <button onclick="toggle('questoes')"
                class="w-full text-left p-4 text-lg font-semibold flex justify-between items-center">
            Questões
            <span>▼</span>
        </button>

        <div id="questoes" class="hidden border-t p-5">

            <h3 class="text-lg font-semibold mb-3">Criar / Editar Questão</h3>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">

                <select id="formularioSelect" class="border rounded p-2">
                    <option value="">Selecione um formulário</option>
                </select>

                <select id="tipoQuestao" class="border rounded p-2">
                    <option value="objetiva">Objetiva</option>
                    <option value="discursiva">Discursiva</option>
                </select>

                <select id="obrigatoria" class="border rounded p-2">
                    <option value="true">Obrigatória</option>
                    <option value="false">Opcional</option>
                </select>

            </div>

            <textarea id="enunciado" class="border rounded p-2 w-full mt-4" rows="3" placeholder="Enunciado"></textarea>

            <div class="mt-4 flex gap-3">
                <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Salvar</button>
                <button class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Atualizar</button>
                <button class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Excluir</button>
            </div>

            <h4 class="mt-6 text-md font-semibold">Lista de Questões:</h4>
            <table class="w-full mt-2 border">
                <thead class="bg-gray-200">
                <tr>
                    <th class="p-2 border">ID</th>
                    <th class="p-2 border">Enunciado</th>
                    <th class="p-2 border">Tipo</th>
                    <th class="p-2 border">Obrigatória</th>
                </tr>
                </thead>
                <tbody id="tabelaQuestoes">
                </tbody>
            </table>

        </div>
    </div>

    <!-- ACORDEÃO 4 - ALTERNATIVAS -->
    <div class="mb-4 bg-white shadow rounded-xl">
        <button onclick="toggle('alternativas')"
                class="w-full text-left p-4 text-lg font-semibold flex justify-between items-center">
            Alternativas
            <span>▼</span>
        </button>

        <div id="alternativas" class="hidden border-t p-5">

            <h3 class="text-lg font-semibold mb-3">Criar / Editar Alternativa</h3>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">

                <select id="questaoSelect" class="border rounded p-2">
                    <option value="">Selecione uma questão</option>
                </select>

                <input type="number" id="peso" class="border rounded p-2" placeholder="Peso">

                <input type="text" id="textoAlternativa" class="border rounded p-2" placeholder="Texto da alternativa">

            </div>

            <div class="mt-4 flex gap-3">
                <button class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Salvar</button>
                <button class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Atualizar</button>
                <button class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Excluir</button>
            </div>

            <h4 class="mt-6 text-md font-semibold">Lista de Alternativas:</h4>
            <table class="w-full mt-2 border">
                <thead class="bg-gray-200">
                <tr>
                    <th class="p-2 border">ID</th>
                    <th class="p-2 border">Texto</th>
                    <th class="p-2 border">Peso</th>
                </tr>
                </thead>
                <tbody id="tabelaAlternativas">
                </tbody>
            </table>

        </div>
    </div>

</div>
<script>
    const API_URL = "http://localhost:8080/SistemaFormulario/api/admin/processos";

// ------------------------
// GET - Buscar processos
// ------------------------
async function carregarProcessos() {
    const tabela = document.getElementById("tabelaProcessos");
    tabela.innerHTML = "<tr><td colspan='4'>Carregando...</td></tr>";

    try {
        const response = await fetch(API_URL);
        const data = await response.json();

        tabela.innerHTML = ""; // limpa a tabela

        data.forEach(proc => {
            tabela.innerHTML += `
                <tr>
                    <td class="border p-2">${proc.id}</td>
                    <td class="border p-2">${formatarData(proc.dataInicio)}</td>
                    <td class="border p-2">${formatarData(proc.dataFim)}</td>
                    <td class="border p-2">${proc.descricao}</td>
                </tr>
            `;
        });

    } catch (e) {
        tabela.innerHTML = "<tr><td colspan='4' class='text-red-600'>Erro ao carregar.</td></tr>";
    }
}

// Converte o array [2025,11,12,0,0] para string "2025-11-12"
function formatarData(arr) {
    if (!arr || arr.length < 3) return "-";
    const [ano, mes, dia] = arr;
    return `${ano}-${String(mes).padStart(2,"0")}-${String(dia).padStart(2,"0")}`;
}

// ------------------------
// POST - Criar processo
// ------------------------
async function salvarProcesso() {
    const descricao = document.getElementById("descricao").value;
    const dataInicio = document.getElementById("datainicio").value;
    const dataFim = document.getElementById("datafim").value;

    if (!descricao || !dataInicio || !dataFim) {
        alert("Preencha todos os campos!");
        return;
    }

    const body = {
        descricao: descricao,
        dataInicio: dataInicio + "T00:00:00",
        dataFim: dataFim + "T00:00:00"
    };

    console.log("Enviando:", body);

    try {
        await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
        });

        alert("Processo salvo!");
        carregarProcessos();

    } catch (e) {
        alert("Erro ao salvar processo.");
    }
}

// Vincula o botão Salvar
document.addEventListener("DOMContentLoaded", () => {
    carregarProcessos();

    document.querySelector("button.bg-green-600")
        .addEventListener("click", salvarProcesso);
});
</script>
</body>
</html>
